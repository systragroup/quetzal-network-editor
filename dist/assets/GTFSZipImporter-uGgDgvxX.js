import{_ as C,g as i,h as S,i as l,Z as O,C as N,j as o,bg as A,B as H,aK as Z,a5 as K,u as R,r as f,e as v,o as W,bh as j,f as Y,q as _,v as r,aa as b,y as n,x as h,aF as D,a2 as F,G as y,am as J,F as V,E as x,l as Q,N as X,bi as $,V as ee,L as G,a3 as te,a4 as I,a8 as se,be as ae,bf as ne}from"./index-74_Gta_C.js";const re={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(e){this.$emit("update:date",this.parseOutput(e))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(e){if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))},parseOutput(e){return e.toISOString().substring(0,10).replaceAll("-","")}}};function le(e,a,g,s,d,u){return i(),S(H,{modelValue:d.menu,"onUpdate:modelValue":a[1]||(a[1]=p=>d.menu=p),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:l(({props:p})=>[o(O,N({"model-value":u.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},p),null,16,["model-value"])]),default:l(()=>[o(A,{modelValue:d.isoDate,"onUpdate:modelValue":a[0]||(a[0]=p=>d.isoDate=p),max:d.dateMax,min:d.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const oe=C(re,[["render",le],["__scopeId","data-v-1eb87a33"]]),U=e=>e,ie={name:"GTFSWebImporter",components:{DatePicker:oe},setup(){const e=Z(),a=K(),g=R(),s=f(!1),d=f(null),u=f({}),p=f([]),t=f(!1),c=f(!1),m=v(()=>a.linksIsEmpty),k=v(()=>e.UploadedGTFS),M=v(()=>e.callID),E=v(()=>e.running),L=v(()=>e.error),P=v(()=>e.errorMessage),B=v(()=>k.value.filter(w=>w.progress<100).length>0);W(()=>{e.saveParams(T.value)});const q=/^(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/,z={required:w=>!!w||U("Required"),timeRule:w=>q.test(w)||U("invalid date time")},T=f([{name:"start_time",text:"start time",value:e.parameters.start_time,type:"String",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required","timeRule"]},{name:"end_time",text:"end time",value:e.parameters.end_time,type:"String",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required","timeRule"]}]);return{showOverwriteDialog:s,poly:d,runGTFS:e,store:g,nodes:u,gtfsList:p,checkall:t,showHint:c,parameters:T,rules:z,linksIsEmpty:m,UploadedGTFS:k,callID:M,running:E,error:L,errorMessage:P,isUploading:B}},methods:{uploadGTFS(){this.$refs.zipInput.click(),document.getElementById("zip-input").value=""},async readZip(e){try{this.store.changeLoading(!0);const a=e.target.files;if(!a.length){this.store.changeLoading(!1);return}for(const g of a){const s=await j(g),d=s.reduce((t,c)=>c.start_date<t?c.start_date:t,s[0].start_date),u=s.reduce((t,c)=>c.end_date>t?c.end_date:t,s[0].end_date),p={content:g,info:{name:g.name,minDate:d,maxDate:u,date:d,progress:0}};await this.runGTFS.addGTFS(p)}this.store.changeLoading(!1)}catch(a){this.store.changeLoading(!1),this.store.changeAlert(a)}},importGTFS(){if(this.linksIsEmpty){const e=this.UploadedGTFS.map(s=>s.name),a=this.UploadedGTFS.map(s=>s.date),g={files:e,dates:a};this.parameters.forEach(s=>{g[s.name]=s.value}),this.runGTFS.startExecution(g)}else this.showOverwriteDialog=!0},applyOverwriteDialog(){this.store.initLinks(),this.showOverwriteDialog=!1,this.importGTFS()}}},de=e=>(ae("data-v-f2e16997"),e=e(),ne(),e),ue={class:"params-row"},ce={class:"list"},pe={class:"list-row bold"},me=de(()=>r("span",{class:"list-item-small"},null,-1)),he={class:"list-item-large"},ge={class:"list-item-medium"},fe={class:"list-item-medium"},ve={class:"list-item-medium"},_e={class:"list-item-small"},Se={class:"list-item-small"},we={class:"list-item-large"},ye={class:"list-item-medium"},De={class:"list-item-medium"},Ve={class:"list-item-medium"},xe={class:"list-item-small"},ke={class:"bottom-button"};function Te(e,a,g,s,d,u){const p=Y("DatePicker");return i(),_("div",null,[r("input",{id:"zip-input",ref:"zipInput",type:"file",style:{display:"none"},accept:".zip",multiple:"multiple",onChange:a[0]||(a[0]=(...t)=>u.readZip&&u.readZip(...t))},null,544),o(G,{class:"card"},{default:l(()=>[o(b,{class:"subtitle"},{default:l(()=>[h(n(e.$gettext("GTFS importer")),1)]),_:1}),o(D,null,{default:l(()=>[h(n(e.$gettext("import GTFS from local computer")),1)]),_:1}),o(D,null,{default:l(()=>[h(n(e.$gettext("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),o(F,null,{default:l(()=>[o(y,{variant:"elevated",disabled:s.running,"prepend-icon":"fa-solid fa-file-archive",onClick:u.uploadGTFS},{default:l(()=>[h(n(e.$gettext("upload GTFS")),1)]),_:1},8,["disabled","onClick"])]),_:1}),o(D,null,{default:l(()=>[s.error?(i(),S(J,{key:0,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[h(n(e.$gettext("There as been an error while converting your GTFS.             Please try again. If the problem persist, contact us."))+" ",1),(i(!0),_(V,null,x(Object.keys(s.errorMessage),t=>(i(),_("p",{key:t},[r("b",null,n(t)+": ",1),h(n(s.errorMessage[t]),1)]))),128))]),_:1})):Q("",!0)]),_:1}),r("div",ue,[(i(!0),_(V,null,x(s.parameters,(t,c)=>(i(),_("div",{key:c,class:"params"},[typeof t.items>"u"?(i(),S(O,{key:0,modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,type:t.type,variant:"underlined",label:e.$gettext(t.text),suffix:t.units,hint:s.showHint?e.$gettext(t.hint):"","persistent-hint":s.showHint,rules:t.rules.map(m=>s.rules[m]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):(i(),S(X,{key:1,modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,type:t.type,items:t.items,label:e.$gettext(t.text),suffix:t.units,hint:s.showHint?e.$gettext(t.hint):"","persistent-hint":s.showHint,rules:t.rules.map(m=>s.rules[m]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),r("div",ce,[r("li",pe,[me,r("span",he,n(e.$gettext("name")),1),r("span",ge,n(e.$gettext("from")),1),r("span",fe,n(e.$gettext("to")),1),r("span",ve,n(e.$gettext("selected date")),1),r("span",_e,n(e.$gettext("Uploaded")),1)]),(i(!0),_(V,null,x(s.UploadedGTFS,(t,c)=>(i(),_("ul",{key:c,class:"list-row"},[r("span",Se,n(c),1),r("span",we,n(t.name),1),r("span",ye,n(t.minDate),1),r("span",De,n(t.maxDate),1),r("span",Ve,[o(p,{date:t.date,from:t.minDate,to:t.maxDate,"onUpdate:date":m=>t.date=m},null,8,["date","from","to","onUpdate:date"])]),r("span",xe,[t.progress<100?(i(),S($,{key:0,indeterminate:t.progress===0,absolute:"",color:"primary","model-value":t.progress},null,8,["indeterminate","model-value"])):(i(),S(ee,{key:1},{default:l(()=>[h("fas fa-check")]),_:1}))])]))),128))]),r("div",ke,[o(y,{loading:s.running,disabled:s.running||s.UploadedGTFS.length==0||s.isUploading,color:s.running||s.UploadedGTFS.length==0||s.isUploading?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:u.importGTFS},{default:l(()=>[h(n(e.$gettext("convert")),1)]),_:1},8,["loading","disabled","color","onClick"])])]),_:1}),o(se,{modelValue:s.showOverwriteDialog,"onUpdate:modelValue":a[2]||(a[2]=t=>s.showOverwriteDialog=t),persistent:"","max-width":"500",onKeydown:[I(u.applyOverwriteDialog,["enter"]),a[3]||(a[3]=I(t=>s.showOverwriteDialog=!1,["esc"]))]},{default:l(()=>[o(G,null,{default:l(()=>[o(b,{class:"text-h5"},{default:l(()=>[h(n(e.$gettext("Overwrite current road network ?")),1)]),_:1}),o(F,null,{default:l(()=>[o(te),o(y,{color:"regular",onClick:a[1]||(a[1]=t=>s.showOverwriteDialog=!s.showOverwriteDialog)},{default:l(()=>[h(n(e.$gettext("No")),1)]),_:1}),o(y,{color:"primary",onClick:u.applyOverwriteDialog},{default:l(()=>[h(n(e.$gettext("Yes")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Fe=C(ie,[["render",Te],["__scopeId","data-v-f2e16997"]]);export{Fe as default};
