import{_ as M,ad as R,ae as I,e as c,r as F,p as B,g as o,h as p,i as l,j as u,x as f,y as v,aa as N,ac as D,l as V,v as j,af as Y,q as h,E as k,ag as Z,ah as G,ai as X,F as w,a1 as J,Z as K,N as A,U as Q,G as _,a3 as W,V as q,a2 as $,L as O,u as ee,w as te,f as ne,Y as ae,X as L,aj as le,ak as re,al as oe,am as H,z as se,A as ie,an as z}from"./index-4lc4_XmM.js";const T=a=>a,ue={name:"Settings",setup(){const a=R(),n=I(),g=c(()=>a.selectedStepFunction),e=c(()=>a.parameters),y=c(()=>e.value.filter(r=>Object.keys(r).includes("category")&&r.model===g.value)),S=c(()=>{var r;return(r=e.value.filter(m=>((m==null?void 0:m.info)&&(m==null?void 0:m.model))===g.value)[0])==null?void 0:r.info}),d=F([]);B(()=>{d.value=[...Array(y.value.length).keys()].map((r,m)=>m)});const s=c(()=>n.scenariosList),t=c(()=>n.scenario);function x(){a.getParameters({model:n.model,path:n.scenario+"/inputs/params.json"})}function i(){d.value.length<y.value.length?d.value=[...Array(y.value.length).keys()].map((r,m)=>m):d.value=[]}const C=F(null),P=F(!1),b={required:r=>r!=null||T("Required"),largerThanZero:r=>r>0||T("should be larger than 0"),nonNegative:r=>r>=0||T("should be larger or equal to 0")};function U(r){const m=s.value.map(E=>E.scenario);r.value=r.value.filter(E=>m.includes(E))}return{selectedStepFunction:g,paramsBrute:e,errorMessage:C,showHint:P,panel:d,parameters:y,info:S,rules:b,scenariosList:s,activeScenario:t,reset:x,expandAll:i,removeDeletedScenarios:U}}},de={class:"expansion"};function ce(a,n,g,e,y,S){return o(),p(O,{class:"card"},{default:l(()=>[u(N,{class:"subtitle"},{default:l(()=>[f(v(a.$gettext("Scenario Settings")),1)]),_:1}),e.info?(o(),p(D,{key:0,class:"info-div"},{default:l(()=>[f(v(e.info),1)]),_:1})):V("",!0),j("div",de,[u(Q,{ref:"form","lazy-validation":""},{default:l(()=>[u(Y,{modelValue:e.panel,"onUpdate:modelValue":n[0]||(n[0]=d=>e.panel=d),multiple:""},{default:l(()=>[(o(!0),h(w,null,k(e.parameters,(d,s)=>(o(),p(Z,{key:s},{default:l(()=>[u(G,{class:"categorie"},{default:l(()=>[f(v(d.category),1)]),_:2},1024),u(X,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:l(()=>[(o(!0),h(w,null,k(d.params,(t,x)=>(o(),h("li",{key:x},[typeof t.items>"u"&&typeof t.value=="boolean"?(o(),p(J,{key:0,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,color:"primary",label:a.$gettext(t.text),hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof t.items>"u"?(o(),p(K,{key:1,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,variant:"underlined",type:t.type,label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):t.items==="$scenarios"?(o(),p(A,{key:2,modelValue:t.value,"onUpdate:modelValue":[i=>t.value=i,i=>e.removeDeletedScenarios(t)],variant:"underlined",type:t.type,items:e.scenariosList.map(i=>i.scenario).filter(i=>i!==e.activeScenario),multiple:"",label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(o(),p(A,{key:3,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,variant:"underlined",type:t.type,items:t.items,label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),u($,null,{default:l(()=>[u(_,{color:"grey",variant:"text",onClick:e.reset},{default:l(()=>[f(v(a.$gettext("back to default")),1)]),_:1},8,["onClick"]),u(W),u(_,{variant:"text",onClick:e.expandAll},{default:l(()=>[f(v(e.panel.length!=e.parameters.length?a.$gettext("Expand all"):a.$gettext("Collapse all")),1)]),_:1},8,["onClick"]),u(_,{icon:"",size:"small",onClick:n[1]||(n[1]=d=>e.showHint=!e.showHint)},{default:l(()=>[u(q,null,{default:l(()=>[f("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1})}const fe=M(ue,[["render",ce],["__scopeId","data-v-2d0c11c5"]]),pe={name:"Run",components:{ParamForm:fe},setup(){const a=ee(),n=R(),g=I(),e=F(""),y=c(()=>n.steps),S=c(()=>{const r=n.availableModels;return n.avalaibleStepFunctions.filter(m=>r.has(m))}),d=c(()=>n.selectedStepFunction),s=c(()=>n.running),t=c(()=>n.currentStep),x=c(()=>n.error),i=c(()=>n.errorMessage),C=c(()=>n.synchronized),P=c(()=>g.protected),b=c(()=>g.model!==null);B(async()=>{b.value&&(await n.getSteps(),e.value=d.value)}),te(e,async r=>{b.value&&(S.value.includes(r)?(n.setSelectedStepFunction(r),n.getSteps()):(e.value=S.value[0],n.setSelectedStepFunction(S.value[0]),n.getSteps()))});async function U(){try{const r=I();n.initExecution(),await a.exportToS3("inputs"),await a.deleteOutputsOnS3(),a.deleteOutputs(),n.startExecution({scenario:r.scenario})}catch(r){n.terminateExecution(),console.log(r),a.changeAlert(r)}}return{stepFunction:e,store:a,runStore:n,userStore:g,steps:y,avalaibleStepFunctions:S,selectedStepFunction:d,running:s,currentStep:t,error:x,errorMessage:i,synchronized:C,isProtected:P,modelIsLoaded:b,run:U}}},me={key:4};function ve(a,n,g,e,y,S){const d=ne("ParamForm");return o(),p(ae,{class:"background"},{default:l(()=>[u(L,{order:"1"},{default:l(()=>[u(d)]),_:1}),u(L,{order:"2"},{default:l(()=>[u(O,{class:"card"},{default:l(()=>[u(N,{class:"subtitle"},{default:l(()=>[f(v(a.$gettext("Scenario Simulation")),1)]),_:1}),u(le,{modelValue:e.currentStep,"onUpdate:modelValue":n[3]||(n[3]=s=>e.currentStep=s),class:"stepper"},{default:l(()=>[e.avalaibleStepFunctions.length>1?(o(),p(re,{key:0,modelValue:e.stepFunction,"onUpdate:modelValue":n[0]||(n[0]=s=>e.stepFunction=s),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:l(()=>[(o(!0),h(w,null,k(e.avalaibleStepFunctions,s=>(o(),p(oe,{key:s,value:s,disabled:e.running||!e.modelIsLoaded},{default:l(()=>[f(v(s),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):V("",!0),e.synchronized?V("",!0):(o(),p(H,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:l(()=>[f(v(a.$gettext("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),e.error?(o(),p(H,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[f(v(a.$gettext("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),h(w,null,k(Object.keys(e.errorMessage),s=>(o(),h("p",{key:s},[j("b",null,v(s)+": ",1),f(v(e.errorMessage[s]),1)]))),128))]),_:1})):V("",!0),e.isProtected?(o(),p(H,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[f(v(a.$gettext("This scenario is protected. You can not run simulation.")),1)]),_:1})):V("",!0),u(_,{loading:e.running,disabled:e.running||e.isProtected||!e.modelIsLoaded,color:"success",class:"ma-2",onClick:n[1]||(n[1]=s=>e.run())},{default:l(()=>[u(q,{size:"small",style:{"margin-right":"10px"}},{default:l(()=>[f(" fa-solid fa-play ")]),_:1}),f(" "+v(a.$gettext("Run Simulation")),1)]),_:1},8,["loading","disabled"]),se(u(_,{color:"grey",variant:"text",onClick:n[2]||(n[2]=s=>e.runStore.stopExecution())},{default:l(()=>[f(v(a.$gettext("Abort Simulation")),1)]),_:1},512),[[ie,e.running&&e.currentStep!==1]]),e.modelIsLoaded?(o(),h("div",me,[(o(!0),h(w,null,k(e.steps,(s,t)=>(o(),h("div",{key:t+1},[e.error?(o(),p(z,{key:1,complete:e.currentStep>t+1,title:s.name,value:t+1,step:t+1},null,8,["complete","title","value","step"])):(o(),p(z,{key:0,complete:e.currentStep>t+1,color:e.currentStep>=t+1?"primary":"regular",title:s.name,value:t+1,compact:"",step:t+1},null,8,["complete","color","title","value","step"]))]))),128))])):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const he=M(pe,[["render",ve],["__scopeId","data-v-6a6fb4f8"]]);export{he as default};
