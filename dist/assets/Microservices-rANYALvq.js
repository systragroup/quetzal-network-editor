import{_ as k,c as P,f as h,g as c,h as f,M as J,a as Q,b as X,u as H,a7 as R,r as u,e as y,aa as Y,aA as O,aB as V,aC as $,aD as ee,aE as te,i as n,j as a,G as C,l as _,aF as oe,p as re,o as ae,q as I,ab as E,x as m,y as g,a3 as S,aG as se,F as ne,E as ie,v as T,an as le,ac as de,a2 as G,N as ce,aH as me,aI as ue,L as B,a4 as D,a9 as pe,aJ as he,aK as w,aL as ge,al as j,aM as ye,am as M,aN as x}from"./index-CQ8laDfN.js";import{b as fe,a as ve}from"./index-B82vYrTv.js";const be={name:"NodesLayer",components:{MglGeojsonLayer:P},props:["map","nodes","active"],event:["move","rightClick"],data(){return{hoveredStateId:null,keepHovering:!1,dragNode:!1}},computed:{},watch:{},created(){},methods:{onCursor(e){if(this.active&&this.hoveredStateId===null){this.map.getCanvas().style.cursor="pointer";const o=[...new Set(e.mapboxEvent.features.map(r=>r.id))];this.hoveredStateId={layerId:e.layerId,id:o},this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!0})}},offCursor(){this.active&&this.hoveredStateId!==null&&(this.keepHovering?this.dragNode=!0:(this.map.getCanvas().style.cursor="",this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!1}),this.hoveredStateId=null))},rightClick(){var e;if(!this.dragNode&&((e=this.hoveredStateId)==null?void 0:e.layerId)==="nodes"){const r=this.map.querySourceFeatures(this.hoveredStateId.layerId).filter(l=>l.id===this.hoveredStateId.id[0])[0],t={selectedFeature:r};r&&this.$emit("rightClick",t)}},moveNode(e){var o,r;if(this.active&&((o=this.hoveredStateId)==null?void 0:o.layerId)==="nodes"&&e.mapboxEvent.originalEvent.button===0){e.mapboxEvent.preventDefault(),this.map.getCanvas().style.cursor="grab",this.keepHovering=!0;const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.selectedFeature=t.filter(l=>l.id===this.hoveredStateId.id[0])[0],(r=this.selectedFeature)!=null&&r.properties&&(this.map.on("mousemove",this.onMove),this.map.on("mouseup",this.stopMovingNode))}},onMove(e){if(this.dragNode&&this.selectedFeature){const o={selectedFeature:this.selectedFeature,lngLat:Object.values(e.lngLat)};this.$emit("move",o)}},stopMovingNode(e){this.active&&e.originalEvent.button===0&&(this.map.getCanvas().style.cursor="pointer",this.map.off("mousemove",this.onMove),this.keepHovering=!1,this.dragNode=!1,this.map.getCanvas().style.cursor="",this.hoveredStateId&&this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!1}),this.hoveredStateId=null,this.map.off("mouseup",this.stopMovingNode))}}};function _e(e,o,r,t,l,i){const d=h("MglGeojsonLayer");return c(),f(d,{"source-id":"nodes",source:{type:"geojson",data:r.nodes,buffer:0,promoteId:"index"},"layer-id":"nodes",layer:{interactive:!0,type:"circle",paint:{"circle-color":"#ffffff","circle-opacity":.5,"circle-radius":["case",["boolean",["feature-state","hover"],!1],10,5],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0],"circle-stroke-color":e.$vuetify.theme.current.colors.darkgrey,"circle-stroke-width":2}},onMouseover:i.onCursor,onMouseleave:i.offCursor,onMousedown:i.moveNode,onContextmenu:i.rightClick},null,8,["source","layer","onMouseover","onMouseleave","onMousedown","onContextmenu"])}const Se=k(be,[["render",_e]]),F=e=>e,Me="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",Ie={name:"MapSelector",components:{MglMap:J,MglNavigationControl:Q,MglScaleControl:X,MglGeojsonLayer:P,NodesLayer:Se},emits:["change"],setup(){const e=H(),o=R(),r=Me,t=u(!1),l=u(null),i=u({}),d=O,s=u(!1),p=y(()=>e.mapStyle),v=y(()=>o.rlinksIsEmpty);return{store:e,mapIsLoaded:t,mapboxPublicKey:r,poly:l,nodes:i,header:d,freeForm:s,mapStyle:p,rlinksIsEmpty:v}},watch:{mapStyle(){try{this.map.removeLayer("stroke")}catch{}}},beforeDestroy(){var o;const e=(o=this.map)==null?void 0:o.getCenter();e&&this.store.saveMapPosition({mapCenter:[e.lng,e.lat],mapZoom:this.map.getZoom()}),this.storesaveImportPoly({freeForm:this.freeForm,poly:this.poly});try{this.map.removeLayer("stroke")}catch{}},methods:{onMapLoaded(e){var o;e.map.dragRotate.disable(),this.map=e.map,this.map.on("dragend",this.getBounds),this.map.on("zoomend",this.getBounds),this.freeForm=!1,(o=this.store.importPoly)!=null&&o.freeForm?(this.poly=this.store.importPoly.poly,this.toggleFreeForm()):this.getBounds(),this.mapIsLoaded=!0},getBounds(){const e=this.map.getBounds(),o=fe([e._sw.lng,e._sw.lat,e._ne.lng,e._ne.lat]);this.poly=ve(o,-.1*(e._ne.lat-e._sw.lat),{units:"degrees"}),this.poly.geometry.coordinates[0]=this.poly.geometry.coordinates[0].reverse();const r=[e._sw.lat,e._sw.lng,e._ne.lat,e._ne.lng];this.$emit("change",{style:"bbox",geometry:r})},toggleFreeForm(){this.freeForm=!this.freeForm,this.freeForm?(this.map.off("dragend",this.getBounds),this.map.off("zoomend",this.getBounds),this.getNodes(),this.store.changeNotification({text:F("Click to add points. Right click de remove"),autoClose:!1})):(this.map.on("dragend",this.getBounds),this.map.on("zoomend",this.getBounds),this.getBounds(),this.store.changeNotification({text:"",autoClose:!0}))},onHover(){this.freeForm&&(this.map.getCanvas().style.cursor="pointer")},offHover(){this.freeForm&&(this.map.getCanvas().style.cursor="")},getNodes(){const e=Y.cloneDeep(O),o=this.poly.geometry.coordinates[0];o.slice(0,o.length-1).forEach((r,t)=>e.features.push(V(r,{index:$.generate(),coordinatesIndex:t}))),this.nodes=e,this.$emit("change",{style:"poly",geometry:this.poly.geometry.coordinates[0]})},moveNode(e){const o=e.selectedFeature.properties.coordinatesIndex,r=this.poly.geometry.coordinates[0];r[o]=e.lngLat,o===0&&(r[r.length-1]=e.lngLat),this.getNodes()},removeNode(e){const o=e.selectedFeature.properties.coordinatesIndex,r=this.poly.geometry.coordinates[0];r.length<=4?this.store.changeNotification({text:F("Cannot delete anymore"),autoClose:!0}):o===0?this.store.changeNotification({text:F("cannot delete first point of polygon"),autoClose:!0}):(this.poly.geometry.coordinates[0]=[...r.slice(0,o),...r.slice(o+1)],this.getNodes())},addNode(e){if(this.freeForm&&Object.keys(e).includes("mapboxEvent")){const o=this.poly.geometry.coordinates[0],r=e.mapboxEvent.lngLat,t=ee(o),l=V(Object.values(r)),d=te(t,l,{units:"kilometers"}).properties.index+1;o.splice(d,0,Object.values(r)),this.getNodes()}}}};function Ce(e,o,r,t,l,i){const d=h("MglScaleControl"),s=h("MglNavigationControl"),p=h("MglGeojsonLayer"),v=h("NodesLayer"),b=h("MglMap");return c(),f(b,{key:t.mapStyle,class:"map",center:t.store.mapCenter,zoom:t.store.mapZoom,"min-zoom":3,"access-token":t.mapboxPublicKey,"map-style":t.mapStyle,onLoad:i.onMapLoaded,onClick:i.addNode},{default:n(()=>[a(d,{position:"bottom-right"}),a(s,{position:"bottom-right"}),a(C,{class:"freeform-button",size:"small",icon:t.freeForm?"far fa-square":"fas fa-vector-square",onClick:i.toggleFreeForm},null,8,["icon","onClick"]),a(p,{"source-id":"polygon",source:{type:"geojson",data:t.poly,promoteId:"index"},"layer-id":"poly",layer:{interactive:!0,type:"fill",paint:{"fill-color":e.$vuetify.theme.current.colors.linksprimary,"fill-opacity":.3}},onMouseover:i.onHover,onMouseleave:i.offHover},null,8,["source","layer","onMouseover","onMouseleave"]),a(p,{"source-id":"polygon",type:"line",source:"polygon","layer-id":"stroke",layer:{type:"line",paint:{"line-color":e.$vuetify.theme.current.colors.linksprimary,"line-width":3}}},null,8,["layer"]),t.mapIsLoaded?(c(),f(v,{key:0,map:e.map,nodes:t.freeForm?t.nodes:t.header,active:t.freeForm,onMove:i.moveNode,onRightClick:i.removeNode},null,8,["map","nodes","active","onMove","onRightClick"])):_("",!0)]),_:1},8,["center","zoom","access-token","map-style","onLoad","onClick"])}const ke=k(Ie,[["render",Ce],["__scopeId","data-v-b302aaf2"]]),we={name:"OSMImporter",components:{MapSelector:ke},setup(){const e=H(),o=oe(),r=R(),t=u(!1),l=u(null),i=u({}),d=u(null),s=u(!1),p=u(he),v=y(()=>r.rlinksIsEmpty),b=y(()=>o.highway),L=y(()=>o.extendedCycleway),Z=y(()=>o.callID),q=y(()=>o.running),z=y(()=>o.error),A=y(()=>o.errorMessage);function W(U){l.value=U}function N(){v.value?(o.saveParams({highway:d.value,extendedCycleway:s.value}),o.setCallID(),o.startExecution({coords:l.value.geometry,method:l.value.style})):t.value=!0}function K(){e.initrLinks(),t.value=!1,N()}return re(()=>{d.value=b.value,s.value=L.value}),ae(()=>{o.saveParams({highway:d.value,extendedCycleway:s.value})}),{showOverwriteDialog:t,poly:l,nodes:i,selectedHighway:d,selectedExtended:s,highwayList:p,rlinksIsEmpty:v,highway:b,extendedCycleway:L,callID:Z,running:q,error:z,errorMessage:A,getBBOX:W,importOSM:N,applyOverwriteDialog:K}}},xe={class:"background"},Fe={key:1,class:"text-grey text-caption align-self-center"};function Le(e,o,r,t,l,i){const d=h("MapSelector");return c(),I("section",xe,[a(B,{class:"card"},{default:n(()=>[a(E,null,{default:n(()=>[m(g(e.$gettext("Import OSM network in bounding box")),1)]),_:1}),a(S),a(se,null,{default:n(()=>[t.error?(c(),f(le,{key:0,density:"compact",width:"50rem",variant:"outlined",text:"",type:"error"},{default:n(()=>[m(g(e.$gettext("There as been an error while importing OSM network.             Please try again. If the problem persist, contact us."))+" ",1),(c(!0),I(ne,null,ie(Object.keys(t.errorMessage),s=>(c(),I("p",{key:s},[T("b",null,g(s)+": ",1),m(g(t.errorMessage[s]),1)]))),128))]),_:1})):_("",!0)]),_:1}),a(d,{onChange:t.getBBOX},null,8,["onChange"]),a(de),a(G,null,{default:n(()=>[a(S),a(ce,{modelValue:t.selectedHighway,"onUpdate:modelValue":o[0]||(o[0]=s=>t.selectedHighway=s),class:"select",items:t.highwayList,label:"Select Item",variant:"underlined",multiple:""},{selection:n(({item:s,index:p})=>[p<2?(c(),f(me,{key:0},{default:n(()=>[T("span",null,g(s.title),1)]),_:2},1024)):_("",!0),p===2?(c(),I("span",Fe," (+"+g(t.selectedHighway.length-2)+" others) ",1)):_("",!0)]),_:1},8,["modelValue","items"]),a(S),a(ue,{modelValue:t.selectedExtended,"onUpdate:modelValue":o[1]||(o[1]=s=>t.selectedExtended=s),label:"Extended cycleway"},null,8,["modelValue"]),a(S),a(C,{variant:"outlined",color:"success",loading:t.running,disabled:t.running,onClick:t.importOSM},{default:n(()=>[m(g(e.$gettext("Download")),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1}),a(pe,{modelValue:t.showOverwriteDialog,"onUpdate:modelValue":o[3]||(o[3]=s=>t.showOverwriteDialog=s),persistent:"","max-width":"500",onKeydown:[D(t.applyOverwriteDialog,["enter"]),o[4]||(o[4]=D(s=>t.showOverwriteDialog=!1,["esc"]))]},{default:n(()=>[a(B,null,{default:n(()=>[a(E,{class:"text-h5"},{default:n(()=>[m(g(e.$gettext("Overwrite current road network ?")),1)]),_:1}),a(G,null,{default:n(()=>[a(S),a(C,{color:"regular",onClick:o[2]||(o[2]=s=>t.showOverwriteDialog=!t.showOverwriteDialog)},{default:n(()=>[m(g(e.$gettext("No")),1)]),_:1}),a(C,{color:"primary",onClick:t.applyOverwriteDialog},{default:n(()=>[m(g(e.$gettext("Yes")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Ne=k(we,[["render",Le],["__scopeId","data-v-789fe19d"]]),Oe={name:"Microservices",components:{OSMImporter:Ne,MatrixRoadCaster:w(()=>x(()=>import("./MatrixRoadCaster-DK6Tz9VQ.js"),__vite__mapDeps([0,1,2,3]))),GTFSWebImporter:w(()=>x(()=>import("./GTFSWebImporter-BX2GolUu.js"),__vite__mapDeps([4,5,1,2,6]))),GTFSZipImporter:w(()=>x(()=>import("./GTFSZipImporter-jtkRSF-i.js"),__vite__mapDeps([7,1,2,8])))},setup(){const e=ge(),o=u("OSM importer"),r=u("Zip importer"),t=y(()=>e.running);return{tab:o,subtab:r,GTFSrunning:t}}};function Ve(e,o,r,t,l,i){const d=h("OSMImporter"),s=h("GTFSZipImporter"),p=h("GTFSWebImporter"),v=h("MatrixRoadCaster");return c(),I("section",null,[a(j,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=b=>t.tab=b),color:"primary","bg-color":"lightergrey","align-tabs":"center"},{default:n(()=>[a(M,{value:"OSM importer"},{default:n(()=>[m(" OSM importer ")]),_:1}),a(M,{value:"GTFS importer"},{default:n(()=>[m(" GTFS importer ")]),_:1}),a(M,{value:"Matrix Road Caster"},{default:n(()=>[m(" Matrix Road Caster ")]),_:1})]),_:1},8,["modelValue"]),t.tab==="GTFS importer"?(c(),f(j,{key:0,modelValue:t.subtab,"onUpdate:modelValue":o[1]||(o[1]=b=>t.subtab=b),class:"subtabs",color:"primary","bg-color":"lightergrey","align-tabs":"center"},{default:n(()=>[a(M,{disabled:t.GTFSrunning,value:"Zip importer"},{default:n(()=>[m(" Zip importer ")]),_:1},8,["disabled"]),a(M,{disabled:t.GTFSrunning,value:"Web importer"},{default:n(()=>[m(" Web importer ")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])):_("",!0),a(ye,{class:"layout"},{default:n(()=>[t.tab==="OSM importer"?(c(),f(d,{key:0})):t.tab==="GTFS importer"&&t.subtab==="Zip importer"?(c(),f(s,{key:1})):t.tab==="GTFS importer"&&t.subtab==="Web importer"?(c(),f(p,{key:2})):t.tab==="Matrix Road Caster"?(c(),f(v,{key:3})):_("",!0)]),_:1})])}const Ee=k(Oe,[["render",Ve],["__scopeId","data-v-cf3bd28b"]]),Be=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));export{ke as M,Be as a};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/MatrixRoadCaster-DK6Tz9VQ.js","assets/index-CQ8laDfN.js","assets/index-QpKM_fLT.css","assets/MatrixRoadCaster-B1BI11bC.css","assets/GTFSWebImporter-BX2GolUu.js","assets/index-B82vYrTv.js","assets/GTFSWebImporter-CrtczXYV.css","assets/GTFSZipImporter-jtkRSF-i.js","assets/GTFSZipImporter-D05maDOI.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
